<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>360° Панорама с Pannellum</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pannellum/build/pannellum.css">
  <script src="https://cdn.jsdelivr.net/npm/pannellum/build/pannellum.js"></script>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
    }
    #panorama {
      width: 100%;
      height: 100%;
    }
    #interface {
      position: fixed;
      top: 10px;
      left: 10px;
      z-index: 1000;
      background: rgba(255,255,255,0.7);
      padding: 10px;
      border-radius: 5px;
    }
    #back-button {
      position: fixed;
      bottom: 20px;
      left: 20px;
      z-index: 1000;
    }
  </style>
</head>
<body>
  <div id="interface">
    <h2>Загрузите 360° панораму (2:1)</h2>
    <input type="file" id="imageFile" accept="image/*">
    <button onclick="validateImage()">Загрузить</button>
  </div>
  <div id="panorama"></div>

  <script>
    let viewer;

    function validateImage() {
      const file = document.getElementById('imageFile').files[0];
      if (!file) {
        alert("Выберите изображение!");
        return;
      }

      const img = new Image();
      img.onload = function() {
        if (Math.abs(img.width / img.height - 2) > 0.1) {
          alert("Требуется изображение 2:1 (например, 6000x3000)");
          return;
        }
        loadPanorama(URL.createObjectURL(file));
      };
      img.src = URL.createObjectURL(file);
    }

    function loadPanorama(imageSrc) {
      if (viewer) viewer.destroy();

      viewer = pannellum.viewer('panorama', {
        type: 'equirectangular',
        panorama: imageSrc,
        autoLoad: true,
        autoRotate: -2,
        compass: true
      });

      document.getElementById('interface').style.display = 'none';
      
      const backButton = document.createElement('button');
      backButton.id = 'back-button';
      backButton.textContent = 'Назад';
      backButton.onclick = function() {
        viewer.destroy();
        document.getElementById('interface').style.display = 'block';
        backButton.remove();
      };
      document.body.appendChild(backButton);
    }
  </script>
</body>
</html>